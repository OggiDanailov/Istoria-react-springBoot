CREATE TABLE batch_progress(
    id BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
    accuracy FLOAT NOT NULL,
    attempt_count INTEGER NOT NULL,
    best_score INTEGER NOT NULL,
    completed_date TIMESTAMP(6),
    last_attempt_date TIMESTAMP(6),
    mastered BOOLEAN NOT NULL,
    total_points INTEGER NOT NULL,
    batch_id BIGINT,
    user_id BIGINT
);

CREATE TABLE batch_questions(
    batch_id BIGINT NOT NULL,
    question_id BIGINT NOT NULL,
    PRIMARY KEY (batch_id, question_id)
);

INSERT INTO batch_questions VALUES
(2, 11),
(2, 12),
(2, 13),
(2, 14),
(2, 15),
(2, 16),
(2, 20),
(2, 19),
(2, 18),
(2, 17),
(1, 1),
(1, 2),
(1, 3),
(1, 4),
(1, 5),
(1, 6),
(1, 7),
(1, 8),
(1, 9),
(3, 21),
(3, 22),
(3, 29),
(3, 28),
(3, 27),
(3, 26),
(3, 25),
(3, 24),
(3, 23);

CREATE TABLE chapters(
    id BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
    content VARCHAR(50000),
    title VARCHAR(255),
    topic_id BIGINT
);

INSERT INTO chapters VALUES
(1, '# Early Rome & the Kingdom: The Foundation of an Empire (753-509 BCE)

## Introduction to the Regal Period

The history of Rome begins not with empirical historical records, but with legendâ€”a blend of mythology, religious tradition, and the gradual emergence of archaeological evidence. The period known as the Regal Period, or Kingdom of Rome, spans from the traditional founding date of 753 BCE to the fall of the monarchy in 509 BCE. During these two and a half centuries, Rome transformed from a small settlement of shepherds and farmers on the Tiber River into a significant regional power in central Italy, complete with sophisticated political institutions, a distinctive socio-economic structure, and cultural practices that would endure for centuries.

The sources for understanding Early Rome are uniquely challenging. Unlike ancient Greece, which had written records from an early period, Rome''s earliest history was preserved primarily through oral tradition, later compiled into literary narratives by historians such as Livy (Titus Livius, 59 BCE - 17 CE) and Plutarch (46-120 CE), who wrote centuries after the events they described. These sources blend historical fact with legendary embellishment, making it necessary to approach them critically. Archaeological evidence, including pottery fragments, architectural remains, and burial sites excavated on the Palatine Hill and Roman Forum, provides crucial corroboration and often challenges or refines the literary accounts.', 'Early Rome & the Kingdom', 1);

CREATE TABLE periods(
    id BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
    description VARCHAR(255),
    title VARCHAR(255)
);

INSERT INTO periods VALUES
(1, 'A history of the Roman Empire', 'Roman History');

CREATE TABLE question_options(
    question_id BIGINT NOT NULL,
    option VARCHAR(255)
);

INSERT INTO question_options VALUES
(1, '509 BCE'),
(1, '753 BCE'),
(1, '616 BCE'),
(1, '1000 BCE'),
(2, 'Aeneas and Lavinia'),
(2, 'Romulus and Remus'),
(2, 'Tarquinius and Numa'),
(2, 'Jupiter and Mars'),
(3, 'An eagle'),
(3, 'A she-wolf'),
(3, 'A lion'),
(3, 'A bear'),
(4, 'Five'),
(4, 'Seven'),
(4, 'Ten'),
(4, 'Three'),
(5, 'Romulus'),
(5, 'Numa Pompilius'),
(5, 'Servius Tullius'),
(5, 'Tarquinius Priscus'),
(6, 'Maritime trade'),
(6, 'Manufacturing'),
(6, 'Agriculture and land ownership'),
(6, 'Mining'),
(7, 'Plebeians'),
(7, 'Patricians'),
(7, 'Slaves'),
(7, 'Freedmen'),
(8, 'Comitia Centuriata'),
(8, 'Comitia Curiata'),
(8, 'Senate of 300'),
(8, 'Assembly of Fathers'),
(9, 'Numa Pompilius'),
(9, 'Tullus Hostilius'),
(9, 'Servius Tullius'),
(9, 'Tarquinius Superbus'),
(10, '510 BCE'),
(10, '509 BCE'),
(10, '508 BCE'),
(10, '511 BCE'),
(11, 'The legend is completely accurate'),
(11, 'Archaeological evidence shows gradual settlement growth rather than a single founding event'),
(11, 'There is no archaeological evidence for Rome'),
(11, 'The legend correctly identifies Romulus as the sole founder'),
(12, 'Romulus'),
(12, 'Numa Pompilius'),
(12, 'Tullus Hostilius'),
(12, 'Ancus Marcius'),
(13, 'Religious ceremonies only'),
(13, 'Military organization and voting weighted by property'),
(13, 'Religious festivals and celebrations'),
(13, 'Trade and commerce regulation'),
(14, 'A master-slave relationship'),
(14, 'A merchant trading partnership'),
(14, 'An economic and political dependence where clients served patrons in exchange for land and protection'),
(14, 'A religious hierarchical structure'),
(15, 'He was a peaceful reformer'),
(15, 'He introduced Etruscan cultural influence and began major building projects like the Temple of Jupiter'),
(15, 'He established the first laws'),
(15, 'He ended patrician dominance'),
(16, 'He was of Latin descent'),
(16, 'He was possibly of Etruscan origin'),
(16, 'He was a slave who became king'),
(16, 'He was from Alba Longa'),
(17, 'Military defeat in war'),
(17, 'The rape of Lucretia, which sparked a revolt led by Lucius Junius Brutus'),
(17, 'Economic collapse'),
(17, 'Religious displeasure with the gods'),
(18, 'To judge legal cases'),
(18, 'To lead military campaigns'),
(18, 'To maintain the sacred fire of Vesta and preserve the goddess''s purity'),
(18, 'To collect taxes'),
(19, 'Democratic government'),
(19, 'Architectural styles, urban organization, and cultural practices'),
(19, 'Monotheistic religion'),
(19, 'Naval dominance'),
(20, 'Only archaeological evidence'),
(20, 'Contemporary written records and royal archives'),
(20, 'Earlier historians, annalistic tradition, and legend'),
(20, 'Direct interviews with surviving witnesses'),
(21, 'It proves Romulus was a real historical figure'),
(21, 'It shows hut settlements dating to c. 1000 BCE, predating the traditional 753 BCE founding date and suggesting gradual settlement rather than a single founding'),
(21, 'It confirms every detail in Livy''s account'),
(21, 'It reveals Rome was founded on the Aventine Hill, not the Palatine'),
(22, 'Rome became more democratic'),
(22, 'Power shifted from kinship-based organization to wealth-based military organization, giving greater political weight to landowners'),
(22, 'Slaves gained political rights'),
(22, 'Plebeians were excluded from participation'),
(23, 'The myth is completely false and should be ignored'),
(23, 'The myth served ideological purposes while obscuring genuine historical developments of gradual urbanization and cultural synthesis'),
(23, 'The myth is entirely historically accurate'),
(23, 'Archaeological evidence is unreliable and contradicts the literary sources'),
(24, 'Rome had eliminated all class distinctions'),
(24, 'Roman society was becoming more hierarchical and formally stratified, with political rights tied to property ownership and military obligation'),
(24, 'All citizens had equal political power'),
(24, 'Patricians had no advantage over plebeians'),
(25, 'The story was invented by later historians'),
(25, 'While the dramatic narrative is likely legendary, it symbolizes broader tensions between monarchical power and aristocratic values that culminated in the republic''s establishment'),
(25, 'Lucretia was a fictional character'),
(25, 'There is no connection between the story and the end of the monarchy'),
(26, 'Religious and political authority were completely separate'),
(26, 'The king''s role as chief priest and interpreter of divine will (through augury and auspices) legitimized his political decisions and made them appear divinely sanctioned'),
(26, 'Religious authority was subordinate to political power'),
(26, 'Only plebeians had religious authority'),
(27, 'Rome rejected all Etruscan influence'),
(27, 'Rome incorporated Etruscan cultural, architectural, and administrative practices, suggesting either conquest, cultural diffusion, or a mixture of both'),
(27, 'Romans were ethnically identical to Etruscans'),
(27, 'The Etruscans had no influence on Roman development'),
(28, 'Rome uniquely created a classless society'),
(28, 'Like other Mediterranean societies, Rome developed a hierarchical system with hereditary elites, free commoners with limited rights, and enslaved populations, though Rome''s specific institutions were distinctive'),
(28, 'Slaves had full rights'),
(28, 'All classes had equal political power'),
(29, 'It was an isolated event with no broader impact'),
(29, 'It marked Rome''s shift from monarchical to oligarchic republican governance, establishing institutions (Senate, magistrates, assemblies) that would shape Rome''s expansion and influence throughout the Mediterranean for centuries'),
(29, 'It ended all Roman influence'),
(29, 'It marked Rome''s acceptance of foreign rule');

CREATE TABLE questions(
    id BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
    correct_answer INTEGER NOT NULL,
    difficulty INTEGER NOT NULL,
    question VARCHAR(255),
    text_reference VARCHAR(255),
    chapter_id BIGINT
);

INSERT INTO questions VALUES
(1, 1, 1, 'What is the traditional founding date of Rome?', '#introduction-to-the-regal-period', 1),
(2, 1, 1, 'According to legend, who were the twin founders of Rome?', '#the-foundation-myth-romulus-and-remus', 1),
(3, 1, 1, 'Which animal is said to have nursed Romulus and Remus in the legend?', '#the-legend', 1),
(4, 1, 1, 'How many kings ruled Rome during the Regal Period?', '#the-seven-kings-of-rome', 1),
(5, 1, 1, 'Which king is credited with establishing Rome''s religious practices and the Vestal Virgins?', '#2-numa-pompilius-715-673-bce', 1),
(6, 2, 1, 'What was the primary economic basis of Early Rome?', '#economic-basis', 1),
(7, 1, 1, 'Which class of citizens held the greatest political power during the Kingdom?', '#patricians-patres-familias', 1),
(8, 3, 1, 'What was the name of the Senate during the Regal Period?', '#the-senate', 1),
(9, 2, 1, 'Which king is credited with organizing the military into centuries based on wealth?', '#6-servius-tullius-579-534-bce', 1),
(10, 1, 1, 'In what year did the Roman Kingdom end and the Republic begin?', '#the-end-of-the-kingdom-and-transition-to-the-republic', 1),
(11, 1, 2, 'How does the legend of Romulus and Remus differ from archaeological evidence about Rome''s founding?', '#historical-reality-vs-legend', 1),
(12, 2, 2, 'Which king is associated with the destruction of Alba Longa and the combat of the Horatii and Curiatii?', '#3-tullus-hostilius-673-642-bce', 1),
(13, 1, 2, 'What was the primary function of the Comitia Centuriata in the Servian system?', '#servius-tullius-and-the-servian-reforms', 1),
(14, 2, 2, 'What was the patron-client relationship (clientela) in Early Rome?', '#plebeians', 1),
(15, 1, 2, 'Why was Tarquinius Priscus significant in Rome''s development?', '#5-tarquinius-priscus-616-579-bce', 1),
(16, 1, 2, 'What does the name ''Servius Tullius'' suggest about his origins?', '#6-servius-tullius-579-534-bce', 1),
(17, 1, 2, 'According to the traditional narrative, what event led to the fall of Tarquinius Superbus?', '#7-tarquinius-superbus-534-509-bce', 1),
(18, 2, 2, 'What was the primary purpose of the Vestal Virgins in Roman religion?', '#religious-practice', 1),
(19, 1, 2, 'Which Greek and Etruscan influence was most evident in Rome''s 6th century BCE development?', '#culture-and-religion', 1),
(20, 2, 2, 'What sources did historians like Livy rely upon when writing about Early Rome centuries later?', '#literary-sources', 1),
(21, 1, 3, 'How does the archaeological evidence from the Palatine Hill challenge the traditional founding narrative?', '#archaeological-evidence', 1),
(22, 1, 3, 'What does the evolution from the Comitia Curiata to the Comitia Centuriata reveal about Roman social change?', '#assemblies-of-the-people', 1),
(23, 1, 3, 'How can we reconcile the mythological elements in the Romulus and Remus story with the historical developments of Early Rome?', '#historical-reality-vs-legend', 1),
(24, 1, 3, 'What does the Servian Constitution reveal about Roman society during the 6th century BCE?', '#6-servius-tullius-579-534-bce', 1),
(25, 1, 3, 'Why might the Rape of Lucretia narrative be considered symbolic rather than historical fact?', '#7-tarquinius-superbus-534-509-bce', 1),
(26, 1, 3, 'How did the religious authority of the Roman king differ from and reinforce his political power?', '#religious-authority', 1),
(27, 1, 3, 'What can we infer about the relationship between Etruscan and Roman culture based on the later kings'' origins and accomplishments?', '#5-tarquinius-priscus-616-579-bce', 1),
(28, 1, 3, 'How did the structure of Early Roman society (patricians, plebeians, slaves) reflect broader Mediterranean social patterns of the period?', '#socio-economic-structure', 1),
(29, 1, 3, 'Why is the transition from monarchy to republic in 509 BCE considered significant in the context of Mediterranean history?', '#the-end-of-the-kingdom-and-transition-to-the-republic', 1);

CREATE TABLE quiz_attempts(
    id BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
    attempt_date TIMESTAMP(6),
    points_awarded INTEGER NOT NULL,
    score INTEGER NOT NULL,
    total_points INTEGER NOT NULL,
    total_questions INTEGER NOT NULL,
    batch_id BIGINT,
    chapter_id BIGINT,
    user_id BIGINT
);

INSERT INTO quiz_attempts VALUES
(1, TIMESTAMP '2025-11-25 15:36:44.365714', 0, 6, 9, 9, 1, 1, 1),
(2, TIMESTAMP '2025-11-25 15:37:35.243077', 8, 8, 9, 9, 1, 1, 1),
(3, TIMESTAMP '2025-11-25 15:41:30.345768', -10, 2, 20, 10, 2, 1, 1),
(4, TIMESTAMP '2025-11-25 15:47:11.571546', 18, 18, 20, 10, 2, 1, 1),
(5, TIMESTAMP '2025-11-25 15:49:25.495648', 20, 20, 20, 10, 2, 1, 1),
(6, TIMESTAMP '2025-11-25 15:51:24.443873', 9, 9, 9, 9, 1, 1, 1);

CREATE TABLE quiz_batches(
    id BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
    batch_order INTEGER NOT NULL,
    description VARCHAR(255),
    difficulty INTEGER NOT NULL,
    chapter_id BIGINT
);

INSERT INTO quiz_batches VALUES
(1, 1, '', 1, 1),
(2, 1, '', 2, 1),
(3, 1, '', 3, 1);

CREATE TABLE topics(
    id BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
    description VARCHAR(255),
    title VARCHAR(255),
    period_id BIGINT
);

INSERT INTO topics VALUES
(1, 'The Foundation of an Empire (753-509 BCE)', 'Early Roman History', 1);

CREATE TABLE user_progress(
    id BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
    has_passed_chapter BOOLEAN NOT NULL,
    last_studied TIMESTAMP(6),
    questions_answered INTEGER NOT NULL,
    questions_correct INTEGER NOT NULL,
    total_points INTEGER NOT NULL,
    topic_id BIGINT NOT NULL,
    user_id BIGINT NOT NULL,
    UNIQUE (user_id, topic_id)
);

CREATE TABLE users(
    id BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
    account_type VARCHAR(255) NOT NULL,
    created_at TIMESTAMP(6),
    email VARCHAR(255) NOT NULL UNIQUE,
    password_hash VARCHAR(255) NOT NULL,
    premium_expiry_date TIMESTAMP(6),
    stripe_customer_id VARCHAR(255),
    username VARCHAR(255) UNIQUE
);

INSERT INTO users VALUES
(1, 'FREE', TIMESTAMP '2025-11-25 15:10:55.190001', 'ogidan@abv.bg', '$2a$10$qzeFQQiCygZgUvFii4Sw2u8WO4ZREc5TqpskrMXN.eIFlzl/TRzFi', NULL, NULL, NULL);

-- Foreign Keys
ALTER TABLE batch_progress ADD CONSTRAINT fk_batch_progress_user FOREIGN KEY (user_id) REFERENCES users(id);
ALTER TABLE batch_progress ADD CONSTRAINT fk_batch_progress_batch FOREIGN KEY (batch_id) REFERENCES quiz_batches(id);
ALTER TABLE batch_questions ADD CONSTRAINT fk_batch_questions_question FOREIGN KEY (question_id) REFERENCES questions(id);
ALTER TABLE batch_questions ADD CONSTRAINT fk_batch_questions_batch FOREIGN KEY (batch_id) REFERENCES quiz_batches(id);
ALTER TABLE chapters ADD CONSTRAINT fk_chapters_topic FOREIGN KEY (topic_id) REFERENCES topics(id);
ALTER TABLE question_options ADD CONSTRAINT fk_question_options_question FOREIGN KEY (question_id) REFERENCES questions(id);
ALTER TABLE questions ADD CONSTRAINT fk_questions_chapter FOREIGN KEY (chapter_id) REFERENCES chapters(id);
ALTER TABLE quiz_attempts ADD CONSTRAINT fk_quiz_attempts_user FOREIGN KEY (user_id) REFERENCES users(id);
ALTER TABLE quiz_attempts ADD CONSTRAINT fk_quiz_attempts_chapter FOREIGN KEY (chapter_id) REFERENCES chapters(id);
ALTER TABLE quiz_attempts ADD CONSTRAINT fk_quiz_attempts_batch FOREIGN KEY (batch_id) REFERENCES quiz_batches(id);
ALTER TABLE quiz_batches ADD CONSTRAINT fk_quiz_batches_chapter FOREIGN KEY (chapter_id) REFERENCES chapters(id);
ALTER TABLE topics ADD CONSTRAINT fk_topics_period FOREIGN KEY (period_id) REFERENCES periods(id);
ALTER TABLE user_progress ADD CONSTRAINT fk_user_progress_user FOREIGN KEY (user_id) REFERENCES users(id);
ALTER TABLE user_progress ADD CONSTRAINT fk_user_progress_topic FOREIGN KEY (topic_id) REFERENCES topics(id);